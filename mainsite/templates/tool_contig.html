{% extends "base.html" %}

{% block head %}
<title>Metagenomics Clone Bank</title>

<script type="text/javascript" src="/usr/local/lib/python2.7/dist-packages/jquery/static/jquery"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $("select#pool").submit(function(event){
                $.ajax({
                    type:"POST",
                    url:"/contigtool/",
                    data: {'pool': $('#pool').find(":selected").text()},
                });
            });
        }); 
    </script>

{% endblock %}

{% block pagetitle %}
    <title>Contig Retrieval Tool</title>
{% endblock %}

{% block subtitle %}
    <img src="{{ STATIC_URL }}icons/tools256.png" width="64"><h2 class="tools">Contig Retrieval Tool</h2>
{% endblock %}

{% block content %}
    
<p>This custom tool assists with retrieving cosmid DNA sequences from assembled Illumina sequencing data, obtained from
<a href='{{ STATIC_URL }}pooled-sequencing.png'>pooled seqeuncing</a>.</p>
<p>Briefly, cosmids are first Sanger-sequenced at either end to generate cosmid-specific end-tags;
this information can be input into the database as part of the <a href='{% url 'cosmid-end-tag-add' %}'>Add Cosmid</a> page (or added by editing existing Cosmid entries).
For sequencing, the lab selects cosmids, pools the DNA, and cosmids are sequenced as a pool. Users must assemble the seqeuncing
data independently, and upload the contigs into the database through the <a href='{% url 'contig-pool-add' %}'>Add Contigs</a> page.</p>
<p>This tool allows the user to select cosmids from a sequencing pool, on which to execute contig retrieval.
The tool takes each cosmid's end-tags and uses BLAST to retrieve matching contigs. It indicates whether the two retrieved
contigs are matched or unmatched, or indicates an ambiguous result in the case that one end-tag retrieves more than one contig.
Users must validate the contig retrieval results before they are committed to the database.</p>
<p>Please select a pool:</p>

<section id="tool1">
    <table>

    <form action="{% url "contig" %}" method="POST" enctype="multipart/form-data">{% csrf_token %}
    <tr><th>Select Pool</th>
        <td><select id="pool" name="pool">
            {% for entry in pool %}
                <option value="{{entry.id}}"> {{entry.id}}</option>
            {% endfor %}
        </select>
        <input type="submit" name="detail" value="Display Pool" />
        </td>
    </tr>
        {% for selected in detail %}
            <tr><th>Selected Pool</th><td>{{selected.id}}</td></tr>
            <tr><th>Service Provider</th><td>{{selected.service_provider}}</td></tr>
            <tr><th>Max Clones for Pool</th><td>{{selected.max_number}}</td></tr>
            <tr><th>NCBI SRA Accession</th><td>{{selected.ncbi_sra_accession}}</td></tr>
            <tr><th>Comments</th><td>{{selected.pool_comments}}</td></tr>
        {% endfor %}
        
        </table>

</section>    
{% endblock %}

{% block second %}
<section id="tool2">
        
    <table>
        
        <tr><th>Select Cosmids</th></tr>
        
            {% for cos in cosmids %}
                {% if cos in filtered %}
                    <tr><td>{{cos}} within pool</td></tr>
                {% else %}
                    <tr><td><input type="checkbox" name="cos" checked/>{{cos}}</td></tr>
                {% endif %}
            {% endfor %}
           
    </table>  
        <input type="submit" name="submit" value="Submit" />
        </form>
    </table>
</section>
{% endblock %}